<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Kami's Terraforming Mars Tag Manager</title>
<style>
    /* Styling for body, table, and cards */
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
        background: #000 url('wallpaper.jpg') no-repeat center center fixed;
        background-size: cover;
        color: white;
    }
    table { width: 100%; margin: 0 auto; border-collapse: collapse; background-color: rgba(0, 0, 0, 0.7); }
    th, td { padding: 10px; border: 1px solid #ccc; }
    th { background-color: rgba(255, 255, 255, 0.2); }
    button { margin: 5px; padding: 5px 10px; background-color: #333; color: white; }
    img { max-width: 100%; width: 40px; height: auto; }
    h1, h2 { background-color: rgba(0, 0, 0, 0.6); padding: 10px; display: inline-block; border-radius: 10px;}

    /* Add these new styles for the VP Tracker Icon */
    .icon-container {
        position: relative;
        width: 200px; /* Adjust size as needed to make the icon relatively big */
        margin: 20px auto;
    }
    .icon-container img {
        width: 100%;
        height: auto;
        border-radius: 50%;
    }
    .icon-container .vp-number {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 50px; /* Adjust size for the VP number */
        font-weight: bold;
        color: #ffffff;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    /* Style for making tag counter numbers more visible */
    #tagTable td span {
        font-size: 1.5em; /* Make numbers bigger */
        font-weight: bold; /* Make numbers thicker */
        color: #ffffff; /* Ensure the numbers are visible */
    }
    /* Style for making the graph much smaller and with a dark background */
    #progressChartContainer {
    width: 90%; /* Use percentage for better responsiveness */
    max-width: 300px; /* Cap the maximum size */
    margin: 20px auto;
    background-color: rgba(0, 0, 0, 0.8); /* Dark background for easier readability */
    padding: 10px;
    border-radius: 10px;
}
#progressChart {
    width: 100%;
    height: 150px; /* Default height for smaller screens */
}

/* Larger screens (like tablets and PCs) */
@media (min-width: 768px) {
    #progressChartContainer {
        width: 50%; /* Make the container larger for wider screens */
        max-width: 500px; /* Set a larger max width */
    }
    #progressChart {
        height: 250px; /* Increase height for better visibility on larger screens */
    }
}

/* Even larger screens (desktops and above) */
@media (min-width: 1200px) {
    #progressChartContainer {
        width: 40%; /* Increase width for larger screens */
        max-width: 600px; /* Set a larger max width for desktops */
    }
    #progressChart {
        height: 300px; /* Adjust height accordingly */
    }
}
</style>
</style>
</head>
<body>
<h1>Terraforming Mars Manager by Kami</h1>

<!-- Tag Tracker Table with All Tags -->
<table>
<thead><tr><th>Tag</th><th>Count</th><th>Actions</th></tr></thead>
<tbody id="tagTable">
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Earth.png"/> Earth </td><td><span id="earthCount">0</span></td>
<td><button onclick="changeCount('earth', 1)">+</button><button onclick="changeCount('earth', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Space.png"/> Space </td><td><span id="spaceCount">0</span></td>
<td><button onclick="changeCount('space', 1)">+</button><button onclick="changeCount('space', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Animal.png"/> Animal </td><td><span id="animalCount">0</span></td>
<td><button onclick="changeCount('animal', 1)">+</button><button onclick="changeCount('animal', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Plant.png"/> Plant </td><td><span id="plantCount">0</span></td>
<td><button onclick="changeCount('plant', 1)">+</button><button onclick="changeCount('plant', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Building.png"/> Building </td><td><span id="buildingCount">0</span></td>
<td><button onclick="changeCount('building', 1)">+</button><button onclick="changeCount('building', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Event.png"/> Event </td><td><span id="eventCount">0</span></td>
<td><button onclick="changeCount('event', 1)">+</button><button onclick="changeCount('event', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Science.png"/> Science </td><td><span id="scienceCount">0</span></td>
<td><button onclick="changeCount('science', 1)">+</button><button onclick="changeCount('science', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Energy.png"/> Energy </td><td><span id="energyCount">0</span></td>
<td><button onclick="changeCount('energy', 1)">+</button><button onclick="changeCount('energy', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Microbe.png"/> Microbe </td><td><span id="microbeCount">0</span></td>
<td><button onclick="changeCount('microbe', 1)">+</button><button onclick="changeCount('microbe', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Jovian.png"/> Jovian </td><td><span id="jovianCount">0</span></td>
<td><button onclick="changeCount('jovian', 1)">+</button><button onclick="changeCount('jovian', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/City.png"/> City </td><td><span id="cityCount">0</span></td>
<td><button onclick="changeCount('city', 1)">+</button><button onclick="changeCount('city', -1)">-</button></td></tr>
<tr><td><img src="https://killionaire23.github.io/Terraforming-Mars/Venus.png"/> Venus </td><td><span id="venusCount">0</span></td>
<td><button onclick="changeCount('venus', 1)">+</button><button onclick="changeCount('venus', -1)">-</button></td></tr>
</tbody>
</table>

<h2 id="totalTags">Total Tags: 0</h2>

<!-- VP and TR Trackers -->
<div id="vpTracker">
    <h2>Victory Points Tracker</h2>
    <div class="icon-container">
        <img src="Mars.png" alt="Mars Icon">
        <div id="vpNumber" class="vp-number">0</div> <!-- Initial VP value is 0 -->
    </div>
    <button onclick="changeVP(1)">Add VP</button>
    <button onclick="changeVP(-1)">Remove VP</button>
</div>
<div id="trTracker">
    <h2>Terraforming Rating (TR) Tracker</h2>
    <p>Current TR: <span id="trCount">0</span></p>
    <button onclick="changeTR(1)">Add TR</button>
    <button onclick="changeTR(-1)">Remove TR</button>
</div>

<!-- Card Search by Number -->
<div id="cardLookupSection">
    <h2>Search Card by Number</h2>
    <p>Enter a card number to find VP and tags:</p>
    <input id="cardNumberInput" placeholder="Enter card number" type="text"/>
    <button onclick="searchCard()">Search</button>
    <div id="cardDetails"></div>
</div>
<div id="endTurnSection" style="margin-top: 20px;">
    <button onclick="addNewTurn()">End Turn</button>
</div>
<div id="progressChartContainer">
    <h2>Progress Graph</h2>
    <canvas id="progressChart"></canvas>
</div>
<!-- Reset Game Button -->
<div id="resetSection" style="margin-top: 50px;">
    <button onclick="resetGameState()">Reset Game</button>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const tagCounts = { earth: 0, space: 0, animal: 0, plant: 0, building: 0, event: 0, science: 0, energy: 0, microbe: 0, jovian: 0, city: 0, venus: 0 };

    function changeCount(tag, delta) {
        if (!document.getElementById(`${tag}Count`)) {
            console.warn(`Tag element for "${tag}" not found.`);
            return; // Safely skip if the tag does not exist in the HTML
        }
        tagCounts[tag] += delta;
        if (tagCounts[tag] < 0) { tagCounts[tag] = 0; }
        document.getElementById(`${tag}Count`).innerText = tagCounts[tag];
        updateTotalTags();
        saveGameState(); // Save after updating tag counts
    }

    function updateTotalTags() {
        const total = Object.values(tagCounts).reduce((a, b) => a + b, 0);
        document.getElementById('totalTags').innerText = `Total Tags: ${total}`;
    }
    function addNewTurn() {
        // Function to add a new data point at the end of each turn
        const totalTags = Object.values(tagCounts).reduce((a, b) => a + b, 0);

        progressChart.data.labels.push(`Turn ${progressChart.data.labels.length + 1}`);
        progressChart.data.datasets[0].data.push(vpCount);
        progressChart.data.datasets[1].data.push(trCount);
        progressChart.data.datasets[2].data.push(totalTags);

        progressChart.update();
    }
    let vpCount = 0;
    function changeVP(delta) {
        vpCount += delta;
        if (vpCount < 0) { vpCount = 0; }
        document.getElementById('vpNumber').innerText = vpCount;
        saveGameState(); // Save after updating VP
    }

    let trCount = 0;
    function changeTR(delta) {
        trCount += delta;
        if (trCount < 0) { trCount = 0; }
        document.getElementById('trCount').innerText = trCount;
        saveGameState(); // Save after updating TR
    }

    let cardsDatabase = [];

    // Load JSON Data and handle any errors
    async function loadJSONData() {
        try {
            console.log("Attempting to load JSON...");
            const response = await fetch('Card_Database_with_Numbers.json');
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            cardsDatabase = data;
            console.log("JSON Data Loaded Successfully:", cardsDatabase);
        } catch (error) {
            console.error("Error loading JSON:", error);
            document.getElementById("cardDetails").innerHTML = "<p>Error loading card data. Check console for details.</p>";
        }
    }

    // Search Card by Card Number and update VP and tags
    function searchCard() {
        const cardInput = document.getElementById('cardNumberInput').value.trim();
        const isNumeric = /^\d+$/.test(cardInput);
        const cardNumber = isNumeric ? parseInt(cardInput, 10) : cardInput;
        const card = cardsDatabase.find(c => c['Card Number'] === cardNumber);

        if (card) {
            changeVP(Number(card.VP) || 0);
            Object.keys(card).forEach(key => {
                if (key.startsWith("Tag:") && card[key] === 1) {
                    const tag = key.replace("Tag: ", "").toLowerCase();
                    changeCount(tag, 1);
                }
            });

            document.getElementById("cardDetails").innerHTML = `<p>Found card: ${card['Card Name']} with VP: ${card.VP}</p>`;
            console.log("Card found:", card); 
        } else {
            document.getElementById("cardDetails").innerHTML = "<p>Card not found. Please try a different number.</p>";
            console.log("Card not found:", cardInput); 
        }
    }

    // Save game state to local storage
    function saveGameState() {
        const gameState = {
            vpCount,
            trCount,
            tagCounts
        };
        localStorage.setItem('terraformingMarsGameState', JSON.stringify(gameState));
    }

    // Load game state from local storage
    function loadGameState() {
        const savedState = localStorage.getItem('terraformingMarsGameState');
        if (savedState) {
            const gameState = JSON.parse(savedState);
            vpCount = gameState.vpCount || 0;
            trCount = gameState.trCount || 0;
            document.getElementById('vpNumber').innerText = vpCount;
            document.getElementById('trCount').innerText = trCount;

            Object.keys(gameState.tagCounts).forEach(tag => {
                tagCounts[tag] = gameState.tagCounts[tag];
                document.getElementById(`${tag}Count`).innerText = tagCounts[tag];
            });
            updateTotalTags();
        }
    }

    // Reset game state
    function resetGameState() {
        vpCount = 0;
        trCount = 0;
        Object.keys(tagCounts).forEach(tag => {
            tagCounts[tag] = 0;
            document.getElementById(`${tag}Count`).innerText = tagCounts[tag];
        });
        document.getElementById('vpNumber').innerText = vpCount;
        document.getElementById('trCount').innerText = trCount;
        updateTotalTags();
        localStorage.removeItem('terraformingMarsGameState'); // Clear saved state
    }

    // Load JSON and game state on Page Load
    document.addEventListener("DOMContentLoaded", () => {
    const tagCounts = { earth: 0, space: 0, animal: 0, plant: 0, building: 0, event: 0, science: 0, energy: 0, microbe: 0, jovian: 0, city: 0, venus: 0 };
    let vpCount = 0;
    let trCount = 0;

    // Create the chart after DOM is loaded
    let ctx = document.getElementById('progressChart').getContext('2d');
    let progressChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Turn 1'], // Start with the first turn
            datasets: [
                {
                    label: 'Victory Points (VP)',
                    data: [0], // Initial VP value
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 2,
                    fill: false
                },
                {
                    label: 'Terraforming Rating (TR)',
                    data: [0], // Initial TR value
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    fill: false
                },
                {
                    label: 'Total Tags',
                    data: [0], // Initial Total Tags value
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: false
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Turn/Action Number'
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Count'
                    }
                }
            }
        }
    });

    function changeCount(tag, delta) {
        if (!document.getElementById(`${tag}Count`)) {
            console.warn(`Tag element for "${tag}" not found.`);
            return; // Safely skip if the tag does not exist in the HTML
        }
        tagCounts[tag] += delta;
        if (tagCounts[tag] < 0) { tagCounts[tag] = 0; }
        document.getElementById(`${tag}Count`).innerText = tagCounts[tag];
        updateTotalTags();
        saveGameState(); // Save after updating tag counts
    }

    function changeVP(delta) {
        vpCount += delta;
        if (vpCount < 0) { vpCount = 0; }
        document.getElementById('vpNumber').innerText = vpCount;
        saveGameState(); // Save after updating VP
    }

    function changeTR(delta) {
        trCount += delta;
        if (trCount < 0) { trCount = 0; }
        document.getElementById('trCount').innerText = trCount;
        saveGameState(); // Save after updating TR
    }

    function updateTotalTags() {
        const total = Object.values(tagCounts).reduce((a, b) => a + b, 0);
        document.getElementById('totalTags').innerText = `Total Tags: ${total}`;
    }

    function addNewTurn() {
        // Function to add a new data point at the end of each turn
        const totalTags = Object.values(tagCounts).reduce((a, b) => a + b, 0);

        progressChart.data.labels.push(`Turn ${progressChart.data.labels.length + 1}`);
        progressChart.data.datasets[0].data.push(vpCount);
        progressChart.data.datasets[1].data.push(trCount);
        progressChart.data.datasets[2].data.push(totalTags);

        progressChart.update();
    }

    function saveGameState() {
        const gameState = {
            vpCount,
            trCount,
            tagCounts,
            chartData: {
                labels: progressChart.data.labels,
                datasets: progressChart.data.datasets.map(dataset => ({
                    label: dataset.label,
                    data: dataset.data
                }))
            }
        };
        localStorage.setItem('terraformingMarsGameState', JSON.stringify(gameState));
    }

    function loadGameState() {
        const savedState = localStorage.getItem('terraformingMarsGameState');
        if (savedState) {
            const gameState = JSON.parse(savedState);
            vpCount = gameState.vpCount || 0;
            trCount = gameState.trCount || 0;
            document.getElementById('vpNumber').innerText = vpCount;
            document.getElementById('trCount').innerText = trCount;

            Object.keys(gameState.tagCounts).forEach(tag => {
                tagCounts[tag] = gameState.tagCounts[tag];
                document.getElementById(`${tag}Count`).innerText = tagCounts[tag];
            });
            updateTotalTags();

            // Load chart data without duplicating entries
            progressChart.data.labels = gameState.chartData.labels || ['Turn 1'];
            gameState.chartData.datasets.forEach((dataset, index) => {
                progressChart.data.datasets[index].data = dataset.data;
            });

            progressChart.update();
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadGameState();
    });

    function resetGameState() {
        vpCount = 0;
        trCount = 0;
        Object.keys(tagCounts).forEach(tag => {
            tagCounts[tag] = 0;
            document.getElementById(`${tag}Count`).innerText = tagCounts[tag];
        });
        document.getElementById('vpNumber').innerText = vpCount;
        document.getElementById('trCount').innerText = trCount;
        updateTotalTags();
        localStorage.removeItem('terraformingMarsGameState');
        progressChart.data.labels = ['Turn 1'];
        progressChart.data.datasets.forEach(dataset => dataset.data = [0]);
        progressChart.update();
    }

    function changeCount(tag, delta) {
        if (!document.getElementById(`${tag}Count`)) {
            console.warn(`Tag element for "${tag}" not found.`);
            return; // Safely skip if the tag does not exist in the HTML
        }
        tagCounts[tag] += delta;
        if (tagCounts[tag] < 0) { tagCounts[tag] = 0; }
        document.getElementById(`${tag}Count`).innerText = tagCounts[tag];
        updateTotalTags();
        saveGameState(); // Save after updating tag counts
        updateChart(); // Update chart with new data
    }

    function changeVP(delta) {
        vpCount += delta;
        if (vpCount < 0) { vpCount = 0; }
        document.getElementById('vpNumber').innerText = vpCount;
        saveGameState(); // Save after updating VP
        updateChart(); // Update chart with new data
    }

    function changeTR(delta) {
        trCount += delta;
        if (trCount < 0) { trCount = 0; }
        document.getElementById('trCount').innerText = trCount;
        saveGameState(); // Save after updating TR
        updateChart(); // Update chart with new data
    }

    function updateTotalTags() {
        const total = Object.values(tagCounts).reduce((a, b) => a + b, 0);
        document.getElementById('totalTags').innerText = `Total Tags: ${total}`;
    }

    function saveGameState() {
        const gameState = {
            vpCount,
            trCount,
            tagCounts
        };
        localStorage.setItem('terraformingMarsGameState', JSON.stringify(gameState));
    }
</script>
</body>
</html>
